<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>STAY - 실시간 익명 투표</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');

    body{
      font-family:'Inter',sans-serif;
      background:#fff;
      color:#111827;
      overflow-x:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-main { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; }

    /* ✅ 클릭이 막히는 “투명 오버레이”가 있어도 화면이 살아나도록 안전장치 */
    #menu-overlay { position: fixed; inset: 0; display: none !important; pointer-events: none !important; }
    #auth-modal   { display: none !important; pointer-events: none !important; }
    #side-menu    { pointer-events: auto; } /* 메뉴는 열렸을 때만 클릭되면 됨 */

    /* ✅ 버튼 클릭이 확실히 보이도록 */
    button { cursor: pointer; }
    button:active { transform: scale(0.98); }
  </style>
</head>

<body>
  <!-- (원래 UI 유지) -->
  <div id="screen-main" class="flex flex-col items-center justify-center h-screen space-y-8 p-6 text-center">
    <h1 class="text-7xl font-black italic tracking-tighter text-gray-900">STAY.</h1>

    <div class="grid grid-cols-1 gap-3 w-full max-w-xs">
      <button id="btn-create" class="btn-main p-6 rounded-[1.5rem] font-bold text-lg">새 투표 만들기</button>
      <button id="btn-list" class="bg-gray-50 p-6 rounded-[1.5rem] font-bold text-lg text-gray-700 border border-gray-200">전체 투표 목록</button>
    </div>

    <div class="text-xs text-gray-400 pt-8">
      (진단모드) 화면 어디든 클릭하면 “클릭을 막는 요소”를 잡아냅니다.
    </div>
  </div>

  <script>
    // =========================================
    // ✅ 1번 패치: 모든 JS 에러를 alert로 강제 노출
    // =========================================
    window.onerror = (msg, src, line, col, err) => {
      alert(`JS 에러 발생:\n${msg}\n위치: ${line}:${col}`);
      console.error(err);
    };

    // =========================================
    // ✅ 핵심: "지금 화면에서 클릭이 왜 안 되냐"를 100% 잡는 코드
    // - 클릭 순간, 실제로 클릭을 먹는 최상단 요소를 찾아서
    //   id/class/z-index/pointer-events를 alert로 띄움
    // - 그리고 그 요소가 화면 전체를 덮는 놈이면 자동으로 pointer-events:none 처리
    // =========================================
    let once = false;

    function getZ(el){
      const z = getComputedStyle(el).zIndex;
      return z === 'auto' ? 'auto' : z;
    }

    function describe(el){
      if(!el) return "null";
      const cs = getComputedStyle(el);
      const r = el.getBoundingClientRect();
      const id = el.id ? `#${el.id}` : "";
      const cls = el.className ? `.${String(el.className).trim().split(/\s+/).join('.')}` : "";
      return [
        `TAG: ${el.tagName}${id}${cls}`,
        `z-index: ${getZ(el)}`,
        `pointer-events: ${cs.pointerEvents}`,
        `opacity: ${cs.opacity}`,
        `display: ${cs.display}`,
        `position: ${cs.position}`,
        `rect: ${Math.round(r.left)},${Math.round(r.top)} ${Math.round(r.width)}x${Math.round(r.height)}`
      ].join("\n");
    }

    // 캡처링으로 "가장 먼저" 잡는다 (중요)
    window.addEventListener('pointerdown', (e) => {
      const top = document.elementFromPoint(e.clientX, e.clientY);

      // 버튼이면 정상
      if (top && (top.tagName === 'BUTTON' || top.closest('button'))) return;

      // 버튼이 아닌데 클릭이 씹히는 경우 -> 누가 막는지 출력
      if (!once) {
        once = true;
        alert("❌ 버튼이 아니라 이놈이 클릭을 먹고 있음:\n\n" + describe(top));
      }

      // 화면 전체 덮는 놈이면 자동 무력화(강제)
      try {
        const r = top.getBoundingClientRect();
        const covers = (r.width >= window.innerWidth * 0.95) && (r.height >= window.innerHeight * 0.95);
        if (covers) {
          top.style.pointerEvents = "none";
          top.style.background = "rgba(255,0,0,0.05)"; // 아주 옅게 표시(있으면 보임)
          alert("✅ 클릭 차단 오버레이로 판단됨 → pointer-events:none으로 자동 해제함.\n이제 버튼 눌러봐.");
        }
      } catch (err) {}
    }, true);

    // 버튼이 눌리기만 하면 클릭은 살아있는 것
    document.getElementById('btn-create').onclick = () => alert("✅ 버튼 클릭 성공: 새 투표 만들기");
    document.getElementById('btn-list').onclick = () => alert("✅ 버튼 클릭 성공: 전체 투표 목록");

    // 혹시 로딩 직후 갑자기 생기는 오버레이도 강제로 끈다
    window.addEventListener('load', () => {
      const overlay = document.getElementById('menu-overlay');
      if (overlay) {
        overlay.style.display = "none";
        overlay.style.pointerEvents = "none";
      }
      const modal = document.getElementById('auth-modal');
      if (modal) {
        modal.style.display = "none";
        modal.style.pointerEvents = "none";
      }
    });
  </script>
</body>
</html>
